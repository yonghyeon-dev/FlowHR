owner: attendance-agent
version: 1.0.0
scope:
  in:
    - leave request create/update/cancel flow
    - leave approve/reject flow with audit trace
    - leave balance read model contract
  out:
    - leave accrual and carry-over settlement
    - external calendar synchronization
entities:
  - name: LeaveRequest
    description: Employee leave request with period, type, and status.
  - name: LeaveApproval
    description: Approval or rejection decision record with actor and reason.
  - name: LeaveBalanceProjection
    description: Read model of granted, used, and remaining leave days.
api:
  auth:
    - role: employee
      permission: create/update own pending leave request
    - role: manager
      permission: approve or reject leave requests within scope
    - role: admin
      permission: full leave operations
  endpoints:
    - method: POST
      path: /leave/requests
      description: Create leave request.
    - method: PATCH
      path: /leave/requests/{requestId}
      description: Update pending leave request.
    - method: POST
      path: /leave/requests/{requestId}/approve
      description: Approve leave request.
    - method: POST
      path: /leave/requests/{requestId}/reject
      description: Reject leave request with reason.
    - method: GET
      path: /leave/balances/{employeeId}
      description: Retrieve leave balance snapshot.
  events:
    published:
      - name: leave.requested.v1
        description: Emitted when leave request is created.
      - name: leave.approved.v1
        description: Emitted when leave request is approved.
      - name: leave.rejected.v1
        description: Emitted when leave request is rejected.
      - name: leave.canceled.v1
        description: Emitted when pending leave is canceled.
    consumed:
      - name: employee.profile.updated.v1
        description: Employee org/profile metadata updates.
db_changes:
  migrations:
    - id: 2026021401_leave_base
      description: Create leave requests, approvals, and balance projection tables.
  backward_compatible: true
  notes: Additive columns only in initial leave rollout.
invariants:
  - Final leave decisions are immutable and auditable.
  - Employee can mutate only own pending request.
  - Approved leave state is consumable for attendance/payroll downstream.
risk:
  permissions:
    - Unauthorized approval can alter payroll and staffing plans.
  payroll_accuracy:
    - Paid leave misclassification can distort gross-pay totals.
  legal:
    - Leave decision history must be retained for dispute/audit handling.
test_plan:
  unit:
    - leave state transition guard validation
    - leave date normalization by Asia/Seoul
  integration:
    - create/update/approve leave flow
    - reject flow with reason and audit
  regression:
    - overlap detection and boundary-date regressions
  authorization:
    - employee self-service boundary check
    - manager/admin approval check
  payroll_accuracy:
    - approved paid leave classification for payroll consumer compatibility
observability:
  audit_events:
    - leave.requested
    - leave.approved
    - leave.rejected
    - leave.canceled
  metrics:
    - leave_approval_latency_ms
    - leave_request_rejection_rate
  logs:
    - leave authorization denied with actor role
rollout:
  feature_flags:
    - name: leave_request_v1
      default: "off"
    - name: leave_approval_v1
      default: "off"
  migration_strategy: expand-contract
rollback:
  strategy: disable leave flags and route to manual approval process
  max_recovery_time: 30m
deprecations: []
breaking_changes: false
consumer_impact: "New leave contract introduced in WI-0002; no existing API break expected."
references:
  - specs/common/time-and-payroll-rules.md
approval:
  spec_owner: attendance-agent
  qa_owner: qa-agent
